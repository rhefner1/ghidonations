{"ts":1363028794598,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"$(document).ready(function(){\n    $(\"#individual_selector\").hide()\n\n    //Form validation - not yet ready for production\n    $(\"form\").validationEngine()\n\n    if (home_page == \"dashboard\"){\n        // Autocomplete for contacts\n        params = {\"action\" : \"getContactsJSON\"}\n        var url = '/rpc?' + $.param(params)\n        $.getJSON(url, function(data){\n            $(\"input[name=name]\").autocomplete({\n                source: data,\n                select: function(event, ui){\n                    $(\"input[name=email]\").val(ui.item.email)\n\n                    try{\n                        var address = JSON.parse(ui.item.address)\n                        $(\"input[name=street]\").val(address[0])\n                        $(\"input[name=city]\").val(address[1])\n                        $(\"input[name=state]\").val(address[2])\n                        $(\"input[name=zip]\").val(address[3])\n                    }\n                    catch(err) {\n                        void(0)\n                    }\n                }\n            });\n        })\n    }\n    \n\n    $('#team_selector select').bind('change', function(){ \n        var team_key = $(\"#team_selector select\").val()\n        if (team_key == \"general\") {\n            $(\"#individual_selector\").hide(\"fast\")\n        }\n        else {\n            params = {action: \"semi_getTeamMembers\", arg0: JSON.stringify(team_key)}\n            \n            rpcGet(params, function(data){\n                //HTML to be inserted\n                option_html = '<option value=\"none\">None</option>'\n\n                $.each(data, function(name, key) {\n                    option_html = option_html + \n                    \"<option value=\" + key + \">\" + name + \"</option>\"\n                });  \n\n                $(\"#individual_selector select\").html(option_html)\n            })\n\n            $(\"#individual_selector\").show(\"fast\")\n        }   \n    });\n    \n    $(\"#offline\").delegate(\"#save\", \"click\", function(){\n        var validation_result = $(\"form\").validationEngine('validate')\n        if (validation_result == true){\n            var name = $(\"#offline input[name=name]\").val()\n            var email = $(\"#offline input[name=email]\").val()\n            var amount_donated = $(\"#offline input[name=amount_donated]\").val()\n            var notes = $(\"#offline textarea[name=special_notes]\").val()\n\n            var street = $(\"input[name=street]\").val()\n            var city = $(\"input[name=city]\").val()\n            var state = $(\"input[name=state]\").val()\n            var zip = $(\"input[name=zip]\").val()\n\n            address = $.toJSON([street, city, state, zip])\n            \n            var team_key = $(\"#offline select[name=team] option:selected\").val()\n            var individual_key = $(\"#offline select[name=individual] option:selected\").val()\n            var add_deposit = Boolean($(\"input[name=add_deposit]:checked\").val())\n\n            var home_page = $(\"#home_page\").val()\n            var submit_action = \"\"\n            var params\n\n            if (home_page == \"dashboard\"){\n                submit_action = \"offlineDonation\"\n                params = [submit_action, name, email, amount_donated,\n                        notes, address, team_key, individual_key, add_deposit]\n            }\n            else{\n                submit_action = \"semi_createDonation\"\n                var params = [submit_action, name, email, amount_donated,\n                        notes, address, team_key, individual_key]\n            }\n            \n            \n\n            //Flash message\n            show_flash(\"setting\", \"Saving donation...\", false)\n\n            rpcPost(params, function(data){\n                refreshPage()\n            })\n        }\n        \n    })\n});"]],"start1":0,"start2":0,"length1":0,"length2":3690}]],"length":3690}
